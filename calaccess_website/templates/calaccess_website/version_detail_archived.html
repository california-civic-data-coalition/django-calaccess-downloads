{% extends 'calaccess_website/version_detail.html' %}
{% load humanize calaccess_website_tags staticfiles %}

{% block title %}Downloads - {{ object.release_datetime|date:"N j, Y" }} - {{ block.super }}{% endblock%}

{% block meta %}
<meta property="og:site_name" content="{{ CALACCESS_WEBSITE_DOMAIN }}"/>
<meta property="og:title" content="Downloads - {{ object.release_datetime|date:"N j, Y" }} - {{ CALACCESS_WEBSITE_TITLE }}"/>
<meta property="og:description" content="The {{ object.release_datetime|date:"l, N j, Y" }} release of CAL-ACCESS database, the government database that tracks campaign finance and lobbying activity in California politics."/>
<meta property="og:url" content="http://{{ CALACCESS_WEBSITE_DOMAIN }}{{ request.path }}" />
<meta property="og:image" content="http://{{ CALACCESS_WEBSITE_DOMAIN }}/static/calaccess_website/images/brown-bear-share.png"/>

<meta property="twitter:site" content="@cacivicdata">
<meta property="twitter:title" content="Latest download - {{ CALACCESS_WEBSITE_TITLE }}">
<meta property="twitter:description" content="The {{ object.release_datetime|date:"l, N j, Y" }} release of CAL-ACCESS database, the government database that tracks campaign finance and lobbying activity in California politics."/>
<meta property="twitter:url" content="http://{{ CALACCESS_WEBSITE_DOMAIN }}{{ request.path }}" />
<meta property="twitter:image:src" content="http://{{ CALACCESS_WEBSITE_DOMAIN }}/static/calaccess_website/images/brown-bear-share.png">
<meta property="twitter:card" content="summary_large_image">
{% endblock %}

{% block breadcrumbs %}
{{ block.super }}
<li>{{ object.release_datetime|date:"N j, Y" }}, {{ object.release_datetime|date:"P" }}</li>
{% endblock %}

{% block top %}
    <h1>Archived download</h1>
    <p>
        Our archived release of California campaign finance data, extracted from CAL-ACCESS on {{ object.release_datetime|date:"l, N j, Y" }} at {{ object.release_datetime|date:"P" }}
    </p>
    <p>
        <a href="{% url 'version_latest' %}">Latest release &raquo;</a>&nbsp;
        <a href="{% url 'version_archive_index' %}">Other past releases &raquo;</a>
    </p>
{% endblock %}

{% block content %}
{% if processed_version_completed %}
  {% include 'calaccess_website/downloads_basic_section.html' %}
  {% include 'calaccess_website/downloads_advanced_section.html' %}
  {% include 'calaccess_website/downloads_raw_files_section.html' %}
{% else %}
<section id="raw" class="chapter">
  <h2>Raw files</h2>
  <p>
    Get the complete package of {{ object.clean_file_count }} tables released by California's Secretary of State, cleaned and converted into {{ object.clean_record_count|intword }} rows of comma-separated values.
  </p>
  {% if object.clean_zip_archive %}
    <p>
      <a href="{% archive_url object.clean_zip_archive.name is_latest=is_latest %}"
           class="btn btn-calaccess">
            Download
      </a>
      &nbsp; <span>{{ object.pretty_clean_size }} zip</span>
    </p>
    <p>
      Alternatively, retrieve with <code>curl</code>.
    </p>
    <input type="text" class="download-link input-monospace"
        value="$ curl -O {% archive_url object.clean_zip_archive.name is_latest=is_latest %}"
        readonly>
  {% else %}
    <p><a class="btn btn-inactive">Unavailable</a></p>
  {% endif %}
  {% if object.error_count %}
    <p>
       The raw data provided by the state contains errors in how some values are escaped, quoted and delimited. The result is a small number of records lost when we prepare files for download.
    </p>
    <p>
        However, those {{ object.error_count|intcomma }} lost records represent only {{ error_pct|floatformat:"5" }}% of the source data.
    </p>
    {% include 'calaccess_website/error_list.html' %}
  {% endif %}
</section>
{% endif %}

{% endblock %}
