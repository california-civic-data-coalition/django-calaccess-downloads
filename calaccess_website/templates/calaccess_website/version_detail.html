{% extends 'calaccess_website/base.html' %}
{% load humanize calaccess_website_tags %}

{% block title %}{{ object.release_datetime|date:"l, N j, Y (P)" }} - Versions - {{ block.super }}{% endblock%}

{% block container %}
<div class="bg-red">
  <div class="container">
    <div class="row">
    <div class="col-md-9">
      <h2>Snapshot on {{ object.release_datetime|date:"l, N j, Y" }} at {{ object.release_datetime|date:"P" }}</h2>
      <p>Clean data is available in bulk or as individual files. <a href="{% url 'version_archive_index' %}">See all versions &raquo;</a></p>
    </div>
    </div>
  </div>
</div>

<div class="container">
  <section>
  <div class="row">
    <div class="col-md-12">
      <h3>Bulk data</h3>
      {% if object.clean_zip_archive %}
      <p><a href="{% archive_url object.clean_zip_archive.name is_latest=is_latest %}" class="btn btn-calaccess">Download</a>
      &nbsp; <span>{{ object.pretty_size }} zip</span></p>
      <div class="visible-md visible-lg">
        <p>Alternatively, use <code>wget</code> or <code>curl</code> to download this snapshot directly.</p>
        <br />
        <kbd style="padding: 15px;">$ curl {% archive_url object.download_zip_archive.name is_latest=is_latest %}</kbd>
      </div>
      {% else %}
      <p><a class="btn btn-inactive">Download unavailable</a>
      {% endif %}
    </div>
  </div>
  </section>

  <section>
  {% if object.files.all %}
  <div class="row filters">
    <div class="col-md-12">
    <h3>Individual files</h3>
    <p>Filter by file type</p>
      <div class="dropdown">
        <button class="btn btn-calaccess dropdown-toggle" type="button" id="filterDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
          All files
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" aria-labelledby="filterDropdown">
          <li><a data-group="all">All files</a></li>
          {% for group in file_list %}
          <li><a data-group="{{ group.grouper|slugify }}">{{ group.grouper|capfirst }}</a></li>
          {% endfor %}
        </ul>
      </div>

    </div>

  </div>
  

  {% for group in file_list %}
  {% for file in group.list %}
  <div class="row file-card {{ group.grouper|slugify }}">
    <div class="row">
      <div class="col-md-6">
        <h4><a href="{% url 'file_detail' file.file_name|slugify %}">{{ file.file_name }}</a></h4>
      </div>
      <div class="col-md-6 align-right">
        <p class="lbl-group"><mark>{{ group.grouper|upper }}</mark></p>
      </div>
    </div>

    <hr>

    <div class="row">
      <div class="col-md-6">
        <p>{{ file.model.doc.strip|safe }}</p>
      </div>
      <div class="col-md-4 col-md-offset-2 align-right stats">
        {% if file.clean_file_archive %}
        <div class="col-md-8">
        <span>
          <h4>Records</h4>
          <p>{{ file.clean_records_count|intcomma }}</p>
        </span>
        <span>
          <h4>Filesize</h4>
          <p> {{ file.pretty_clean_file_size }}</p>
        </span>
        <span>
          <h4>Errors</h4>
          <p>{{ file.error_count|intcomma }} </p>
        </span>
        </div>
        <div class="col-md-4">
          <a href="{% archive_url file.clean_file_archive.name %}" class="btn btn-calaccess">Download</a>
        </div>
        {% else %}
          <a class="btn btn-inactive">Download unavailable</a>
         {% endif %}
      </div>
    </div>
  </div>

  {% endfor %}
  {% endfor %}

  {% else %}
        <p>No files.</p>
  {% endif %}
  </section>
</div>
</div> <!-- container -->

<script type="text/javascript">
// Filter logic
$('.dropdown-menu a').click(function() {
    $('#filterDropdown').html($(this).html() + ' <span class="caret"></span>');
    $('.file-card').removeClass('hidden');
    var group = $(this).data('group');
    if (group != 'all') {
      $('.file-card:not(.' + group + ')').addClass('hidden');
    }
});
</script>

{% endblock %}
