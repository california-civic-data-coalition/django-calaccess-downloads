{% extends 'calaccess_website/base_with_top.html' %}
{% load humanize calaccess_website_tags %}

{% block javascript %}
<script type="text/javascript">
// Filter logic
$('.dropdown-menu a').click(function() {
    $('#filterDropdown').html($(this).html() + ' <span class="caret"></span>');
    $('.file-card').removeClass('hidden');
    var group = $(this).data('group');
    if (group != 'all') {
      $('.file-card:not(.' + group + ')').addClass('hidden');
    }
});
</script>
{% endblock %}


{% block breadcrumbs %}
{{ block.super }}
<li><a href="{% url 'version_archive_index' %}">Downloads</a></li>
{% endblock %}

{% block content %}
  <section>
    <h3>Full archive</h3>
    {% if object.clean_zip_archive %}
    <p><a href="{% archive_url object.clean_zip_archive.name is_latest=is_latest %}" class="btn btn-calaccess">Download</a>
    &nbsp; <span>{{ object.pretty_clean_size }} zip</span></p>
    <p>Alternatively, download directly with <code>curl</code> or <code>wget</code>.</p>
    <input type="text" class="download-link input-monospace" value="$ curl -O {% archive_url object.clean_zip_archive.name is_latest=is_latest %}" readonly></input>
    {% else %}
    <p><a class="btn btn-inactive">Download unavailable</a>
    {% endif %}
  </section>

{% if file_list %}
<section>
  <div class="filters">
      <h3>Individual files</h3>
      <p>Filter by type</p>
      <div class="dropdown">
        <button class="btn btn-calaccess dropdown-toggle" type="button" id="filterDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
          All tables
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" aria-labelledby="filterDropdown">
          <li><a data-group="all">All tables</a></li>
          {% for group in file_list %}
          <li><a data-group="{{ group.grouper|slugify }}">{{ group.grouper|capfirst }}</a></li>
          {% endfor %}
        </ul>
      </div>
  </div>

  {% for group in file_list %}
  {% for file in group.list %}
    <section class="row file-card {{ group.grouper|slugify }}">
        <hgroup class="row">
            <div class="col-md-6">
                <h4>
                    <a href="{% url 'file_detail' slug=file.file_name|slugify %}">
                        {{ file.file_name }}
                    </a>
                </h4>
            </div>
            <div class="col-md-6 align-right">
                <p class="lbl-group">
                    <mark>{{ group.grouper|upper }}</mark>
                </p>
            </div>
        </hgroup>
        <hr>
        <div class="row">
            <div class="col-md-6">
                <p>{{ file.model.doc|first_line|safe }}</p>
            </div>
            <div class="col-md-5 col-md-offset-1 align-right stats">
                {% if file.clean_file_archive %}
                <div class="col-md-8">
                    <span>
                      <h4>Records</h4>
                      <p>{{ file.clean_records_count|intcomma }}</p>
                    </span>
                    <span>
                      <h4>Size</h4>
                      <p> {{ file.pretty_clean_file_size }}</p>
                    </span>
                    <span>
                      <h4>Errors</h4>
                      <p>{{ file.error_count|intcomma }} </p>
                    </span>
                </div>
                <div class="col-md-4">
                  <a href="{% archive_url file.clean_file_archive.name is_latest=is_latest %}" class="btn btn-calaccess">Download</a>
                </div>
                {% else %}
                  <a class="btn btn-inactive">Download unavailable</a>
                {% endif %}
            </div>
        </div>
  </section>
  {% endfor %}
  {% endfor %}
</section>
{% endif %}
{% endblock %}
