{% extends 'calaccess_website/version/detail.html' %}
{% load humanize calaccess_website_tags staticfiles %}

{% block title %}Downloads - {{ date_string }} - {{ block.super }}{% endblock%}
{% block description %}{{ description }}{% endblock %}

{% block og-title %}Downloads - {{ date_string }} - {{ block.super }}{% endblock %}
{% block og-description %}{{ description }}{% endblock %}
{% block twitter-title %}Downloads - {{ date_string }} - {{ block.super }}{% endblock %}
{% block twitter-description %}{{ description }}{% endblock %}

{% block breadcrumbs %}
{{ block.super }}
<li>{{ object.release_datetime|date:"N j, Y" }}, {{ object.release_datetime|date:"P" }}</li>
{% endblock %}

{% block top %}
    <h1>Archived download</h1>
    <p>
        Our release of California campaign finance data, extracted {% if processed_version_completed %} and processed{% endif %} on {{ object.release_datetime|date:"l, N j, Y" }} at {{ object.release_datetime|date:"P" }}
    </p>
    <p>
        <a href="{% url 'version_latest' %}">Latest release &raquo;</a>&nbsp;
        <a href="{% url 'version_archive_index' %}">Other past releases &raquo;</a>
    </p>
{% endblock %}

{% block content %}
    {% if processed_version_completed %}
    {% include 'calaccess_website/version/sections/basic.html' %}
    {% include 'calaccess_website/version/sections/advanced.html' %}
    {% include 'calaccess_website/version/sections/raw.html' %}
    {% else %}
    <section id="raw" class="chapter">
      <h2>Raw files</h2>
      <p>
        Get the complete package of {{ object.clean_file_count }} tables released by California's Secretary of State, cleaned and converted into {{ object.clean_record_count|intword }} rows of comma-separated values.
      </p>
      {% if object.clean_zip_archive %}
        <p>
          <a href="{% archive_url object.clean_zip_archive.name is_latest=is_latest %}"
               class="btn btn-calaccess">
                Download
          </a>
          &nbsp; <span>{{ object.pretty_clean_size }} zip</span>
        </p>
        <p>
          Alternatively, retrieve with <code>curl</code>.
        </p>
        <input type="text" class="download-link input-monospace"
            value="$ curl -O {% archive_url object.clean_zip_archive.name is_latest=is_latest %}"
            readonly>
      {% else %}
        <p><a class="btn btn-inactive">Unavailable</a></p>
      {% endif %}
      {% if object.error_count %}
        <p>
           The raw data provided by the state contains errors in how some values are escaped, quoted and delimited. The result is a small number of records lost when we prepare files for download.
        </p>
        <p>
            However, those {{ object.error_count|intcomma }} lost records represent only {{ error_pct|floatformat:"5" }}% of the source data.
        </p>
        {% include 'calaccess_website/error_list.html' %}
      {% endif %}
    </section>
{% endif %}

{% endblock %}
